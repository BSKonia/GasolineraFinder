<div class="summary-box">
  <!-- üìÖ INFORMACI√ìN TEMPORAL (SIN RECUADRO) -->
  <div class="info-temporal">
    <h3 class="section-title sin-recuadro">üìÖ INFORMACI√ìN TEMPORAL</h3>
    <div class="info-row sin-borde">
      <span class="info-label">üìÖ Fecha:</span>
      <span class="info-value">{{ fechaActual }}</span>
    </div>
    <div class="info-row sin-borde">
      <span class="info-label">üïê Hora:</span>
      <span class="info-value">{{ horaActual }}</span>
    </div>
  </div>

  <!-- üìç INFORMACI√ìN DE B√öSQUEDA (CON RECUADRO) -->
  <div class="summary-section" *ngIf="filters">
    <h3 class="section-title">üìç INFORMACI√ìN DE B√öSQUEDA</h3>
    <div class="info-row">
      <span class="info-label">üìç Ubicaci√≥n:</span>
      <span class="info-value">{{ obtenerUbicacionFormateada() }}</span>
    </div>
    <div class="info-row">
      <span class="info-label">üìè Radio de b√∫squeda:</span>
      <span class="info-value">{{ (filters.maxDistance ?? 50) }} km</span>
    </div>
    <div class="info-row">
      <span class="info-label">‚õΩ Combustible:</span>
      <span class="info-value">{{ obtenerTipoCombustibleSeleccionado() }}</span>
    </div>
  </div>

  <!-- üìä ESTAD√çSTICAS (CON RECUADRO) -->
  <div class="summary-section">
    <h3 class="section-title">üìä ESTAD√çSTICAS</h3>
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-value">{{ estadisticas.total }}</div>
        <div class="stat-label">Gasolineras</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ formatPrice(estadisticas.precioPromedio) }}</div>
        <div class="stat-label">Precio promedio</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ formatPercentage(estadisticas.porcentajeAbiertasAhora) }}</div>
        <div class="stat-label">Abiertas ahora</div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ MODO BUSCAR: TOP 3 -->
  <div class="summary-section" *ngIf="modo === 'buscar' && stations.length > 0">
    <h3 class="section-title">‚õΩ TOP 3 RECOMENDADAS</h3>
    <div class="top-stations">
      <div *ngFor="let gasolinera of stations.slice(0, 3); let i = index"
           class="top-station"
           [class.highlighted]="i === 0">
        <div class="station-rank">#{{ i + 1 }}</div>

        <div class="station-info">
          <strong>{{ cleanCompanyName(gasolinera.rotulo) }}</strong>
          <div class="station-address">{{ getDireccionVisible(gasolinera) }}</div>

          <div class="station-details">
            <span class="price">{{ formatPrice(obtenerPrecioRelevante(gasolinera)) }}/L</span>
            <span class="distance distance-centered">
              {{ (gasolinera.distanceKm ?? 0) > 0 ? ((gasolinera.distanceKm ?? 0).toFixed(2) + ' km') : '--' }}
            </span>
            <span class="schedule schedule-right">{{ formatearHorario(gasolinera.horario) }}</span>
          </div>

          <div class="route-summary" *ngIf="getRouteInfo(gasolinera)">
            <span class="route-item">üõ£Ô∏è Desv√≠o: {{ (getDesvioKm(gasolinera) ?? 0) | number:'1.1-1' }} km</span>
            <span class="route-item">üí∏ Coste desv√≠o: {{ formatPrice(getDesvioEuro(gasolinera) ?? 0) }}</span>
          </div>

          <!-- ‚úÖ Bot√≥n Ir a Maps (TOP 3) -->
          <div class="station-actions">
            <button
              type="button"
              class="maps-btn"
              (click)="openInGoogleMaps(gasolinera)">
              <span class="maps-ico">üìç</span>
              <span class="maps-text">Ir a maps</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="results-info">
      <p>{{ stations.length }} gasolineras encontradas</p>
    </div>
  </div>

  <!-- ‚úÖ MODO RUTA: TABLA EN DESKTOP + CARDS EN M√ìVIL -->
<div class="summary-section" *ngIf="modo === 'ruta' && stations.length > 0">
  <h3 class="section-title">‚õΩ Gasolineras por km (ruta)</h3>

  <!-- =========================
       DESKTOP/TABLET: TABLA
  ========================== -->
  <div class="ruta-table-wrap ruta-only-desktop">
    <table class="ruta-table">
      <thead>
        <tr>
          <th class="col-empresa">EMPRESA</th>
          <th class="col-dir">DIRECCI√ìN</th>
          <th class="col-precio">PRECIO</th>
          <th class="col-km">DESV√çO KM</th>
          <th class="col-eur">DESV√çO ‚Ç¨</th>
          <th class="col-horario">HORARIO</th>
          <th class="col-maps">MAPS</th>
        </tr>
      </thead>

      <tbody>
        <ng-container *ngFor="let b of rutasPorCubo; let bucketIndex = index">

          <tr class="bucket-separator" *ngIf="bucketIndex > 0">
            <td colspan="7"></td>
          </tr>

          <tr class="bucket-title">
            <td colspan="7">
              <div class="bucket-title-content">
                <span class="bucket-km">Km {{ b.fromKm }}‚Äì{{ b.toKm }}</span>
              </div>
            </td>
          </tr>

          <tr *ngFor="let r of b.items; let last = last"
              [class.last-in-bucket]="last">

            <td class="col-empresa">
              <strong>{{ cleanCompanyName(r.station.rotulo) }}</strong>
            </td>

            <td class="col-dir">{{ getDireccionCompleta(r.station) }}</td>
            <td class="col-precio">{{ formatPrice(r.precio) }}/L</td>
            <td class="col-km">{{ formatKm1(r.desvioKm) }}</td>
            <td class="col-eur">{{ formatEur2(r.desvioEur) }}</td>

            <td class="col-horario">
              <span class="horario-chip">‚ñà {{ formatearHorario(r.horario) }}</span>
            </td>

            <td class="col-maps">
              <button
                type="button"
                class="btn-open-maps small"
                (click)="openInGoogleMaps(r.station)">
                <span class="maps-ico">üìç</span>
                <span class="maps-text">Ir a maps</span>
              </button>
            </td>

          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- =========================
       M√ìVIL: TARJETAS (SIN SCROLL HORIZONTAL)
  ========================== -->
  <div class="ruta-cards-wrap ruta-only-mobile">
    <ng-container *ngFor="let b of rutasPorCubo; let bucketIndex = index">

      <div class="ruta-bucket-card" *ngIf="b.items?.length">
        <div class="ruta-bucket-header">
          <span class="bucket-km">Km {{ b.fromKm }}‚Äì{{ b.toKm }}</span>
          <span class="bucket-count">{{ b.items.length }}</span>
        </div>

        <div class="ruta-cards">
          <div class="ruta-card" *ngFor="let r of b.items">
            <div class="ruta-card-top">
              <div class="ruta-card-empresa">
                {{ cleanCompanyName(r.station.rotulo) }}
              </div>

              <div class="ruta-card-precio">
                {{ formatPrice(r.precio) }}/L
              </div>
            </div>

            <div class="ruta-card-dir">
              {{ getDireccionCompleta(r.station) }}
            </div>

            <div class="ruta-card-meta">
              <div class="meta-item">
                <span class="meta-label">Desv√≠o</span>
                <span class="meta-value">{{ formatKm1(r.desvioKm) }} km</span>
              </div>

              <div class="meta-item">
                <span class="meta-label">Coste</span>
                <span class="meta-value">{{ formatEur2(r.desvioEur) }}</span>
              </div>
            </div>

            <div class="ruta-card-bottom">
              <span class="horario-chip mobile">‚ñà {{ formatearHorario(r.horario) }}</span>

              <button
                type="button"
                class="btn-open-maps"
                (click)="openInGoogleMaps(r.station)">
                <span class="maps-ico">üìç</span>
                <span class="maps-text">Ir a maps</span>
              </button>
            </div>
          </div>
        </div>
      </div>

    </ng-container>
  </div>

  <div class="results-info">
    <p>{{ stations.length }} gasolineras encontradas</p>
  </div>
</div>


  <!-- Mensaje cuando no hay filtros -->
  <div class="summary-section" *ngIf="!filters">
    <h3 class="section-title">üìç INFORMACI√ìN DE B√öSQUEDA</h3>
    <div class="info-row">
      <span class="info-label">‚è≥ Estado:</span>
      <span class="info-value">Esperando configuraci√≥n de filtros...</span>
    </div>
  </div>
</div>
